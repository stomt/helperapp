function stopBubble(a){a.preventDefault(),a.stopPropagation(),a.stopImmediatePropagation()}function IsValidAmount(a){if(0==a.length)return!1;var b=parseInt(a);return b==Number.NaN?!1:0>=b?!1:!0}function setHeader(a){cities&&a?$(".city").html(cities[a]):$(".city").html("Overview")}function createCookie(a,b,c){var d;if(c){var e=new Date;e.setTime(e.getTime()+864e5*c),d="; expires="+e.toGMTString()}else d="";document.cookie=encodeURIComponent(a)+"="+encodeURIComponent(b)+d+"; path=/"}function readCookie(a){for(var b=encodeURIComponent(a)+"=",c=document.cookie.split(";"),d=0;d<c.length;d++){for(var e=c[d];" "===e.charAt(0);)e=e.substring(1,e.length);if(0===e.indexOf(b))return decodeURIComponent(e.substring(b.length,e.length))}return null}function eraseCookie(a){createCookie(a,"",-1)}function setContent(a){$("#helpRequests").html(a).trigger("create")}function getCity(){return city||readCookie("city")}function setCity(a){city=a,createCookie("city",a,60)}var city=null,cities=["","Bhaktapur","Dhading","Dolakha","Gorkha","Kathmandu","Kavre","Lalitpur","Lamjung","Ramechhap","Rasuwa"],baseUrl="//"+document.location.hostname+":"+location.port+"/cities",tc="tap";$(document).on("pagebeforecreate",function(){var c=$.mobile.pageContainer.pagecontainer("getActivePage")[0].id;if("searchHelp"==c){null==city?$.ajax({url:baseUrl,context:this}).success(function(a){a.success?(city=a.city_id,setHeader(city)):(alert("shit 1"),$.mobile.pageContainer.pagecontainer("change","#home"))}):setHeader(city);var d=new Date,e=(new Date).getTimezoneOffset(),f=d.getUTCDay(),g=new Array;g[0]="Sunday",g[1]="Monday",g[2]="Tuesday",g[3]="Wednesday",g[4]="Thursday",g[5]="Friday",g[6]="Saturday";for(var h=0;h<=g.length;h++)0==h?$("#choice-day-"+h).html("Today ("+g[(f+h)%g.length]+")"):1==h?$("#choice-day-"+h).html("Tomorrow ("+g[(f+h)%g.length]+")"):$("#choice-day-"+h).html(g[(f+h)%g.length]);$("#select-choice-day").selectmenu("refresh",!0);var i=d.getUTCHours()-e/60;$("#choice-hour-"+i).attr("selected",!0),$("#select-choice-hours").selectmenu("refresh",!0)}}).on("pagecontainertransition",function(){var c=$.mobile.pageContainer.pagecontainer("getActivePage")[0].id;"home"==c&&$(document).on("change",".chooseCity",function(a){stopBubble(a),setCity($(this).val()),$.ajax({type:"post",url:baseUrl,context:this,data:{city_id:city}}).success(function(a){a.success&&(createCookie("city",city,60),$.mobile.changePage("#offerHelp"))})}),"searchHelp"==c&&$("#createHelpRequest").on(tc,function(a){return stopBubble(a),0==IsValidAmount($("#helperRequested").val())?(alert("How many helpers are nedded?"),!1):""==$.trim($("#address").val())?(alert("Please enter an address"),!1):($.ajax({type:"post",url:baseUrl+"/"+city+"/insertions",context:this,data:$(this).parent().serialize()}).success(function(a){a.success?$.mobile.pageContainer.pagecontainer("change","#offerHelp"):alert("Something failed.")}),void 0)}),"helpdata"==c&&($(".city").html("Your overview"),$.ajax({url:baseUrl+"/myhelp",context:this}).success(function(a){a.success&&$("#helpDataReq").html(a.html).trigger("create")}),$(this).on(tc,".help",function(a){stopBubble(a),$(this).html('<span class="ui-btn-inner"><span class="ui-btn-text">Please wait...</span></span>').removeAttr("data-role");var b=$(this).data("amount");$.ajax({type:"post",url:baseUrl+"/"+city+"/insertions/"+$(this).data("iid")+"/help",context:this,data:{amount:b},dataType:"json"}).success(function(a){a.success&&$("#helpDataReq").html(a.html).trigger("create")})}).on("change",".amountHelper",function(a){stopBubble(a);var b=parseInt($("select.amountHelper option:selected").val()),c=$(this).parent().parent().parent().find(".help");"increaseHelp"==c.data("help")?c.html('<span class="ui-btn-inner"><span class="ui-btn-text">'+(b>1?"are coming!":"come!")+"</span></span>").data("amount",b):c.html('<span class="ui-btn-inner"><span class="ui-btn-text">'+(b>1?"Revoke "+b:"Revoke!")+"</span></span>").data("amount",-b)}).on(tc,".delete",function(a){stopBubble(a),$.ajax({type:"delete",url:baseUrl+"/"+city+"/insertions/"+$(this).data("iid"),context:this,dataType:"json"}).success(function(a){a.success?$("#helpDataReq").html(a.html).trigger("create"):alert("Deleting the help-request failed.")})})),"offerHelp"==c&&(city=getCity(),setHeader(city),$.ajax({url:baseUrl+"/"+city+"/insertions",context:this}).done(function(a){a.success&&setContent(a.html)}),$(this).on(tc,".delete",function(a){stopBubble(a),$.ajax({type:"delete",url:baseUrl+"/"+city+"/insertions/"+$(this).data("iid"),context:this,dataType:"json"}).success(function(a){a.success?setContent(a.html):alert("Deleting the help-request failed.")})}).on(tc,".help",function(a){stopBubble(a),$(this).html('<span class="ui-btn-inner"><span class="ui-btn-text">Please wait...</span></span>').removeAttr("data-role");var b=$(this).data("amount");$.ajax({type:"post",url:baseUrl+"/"+city+"/insertions/"+$(this).data("iid")+"/help",context:this,data:{amount:b},dataType:"json"}).success(function(a){a.success&&setContent(a.html)})}).on("change",".amountHelper",function(a){stopBubble(a);var b=parseInt($("select.amountHelper option:selected").val()),c=$(this).parent().parent().parent().find(".help");"increaseHelp"==c.data("help")?c.html('<span class="ui-btn-inner"><span class="ui-btn-text">'+(b>1?"will come!":"will come!")+"</span></span>").data("amount",b):c.html('<span class="ui-btn-inner"><span class="ui-btn-text">'+(b>1?"Revoke "+b:"Revoke!")+"</span></span>").data("amount",-b)}))}).bind("pagecreate",function(){$(document).on(tc,'a[data-icon="home"]',function(a){stopBubble(a),$.mobile.pageContainer.pagecontainer("change","#home")})}).one("mobileinit",function(){$.ajaxSetup(),$.mobile.linkBindingEnabled=!0,$.mobile.ajaxEnabled=!0,$.fx.off=!0});