function IsValidAmount(a){if(0==a.length)return!1;var b=parseInt(a);return b==Number.NaN?!1:0>=b?!1:!0}function setHeader(a){cities&&a?$(".city").html(cities[a]):$(".city").html("Overview")}function setContent(a){$("#helpRequests").html(a).trigger("create")}var city=null,cities=null,baseUrl="//"+document.location.hostname+":"+location.port+"/cities",tc="tap",homeUsed=!1;$(document).on("pagecontainerbeforeshow",function(){var c=$.mobile.pageContainer.pagecontainer("getActivePage")[0].id;if("home"==c&&(0==homeUsed?$.ajax({url:baseUrl,context:this,dataType:"json"}).success(function(a){if(a.success){cities=a.cities;var b=window.location.hash,c=b.substr(1,b.length);void 0!=c&&""!=c?$.each(cities,function(a,b){b==c&&(city=a,$.mobile.pageContainer.pagecontainer("change","#offerHelp"))}):(null==city&&(city=a.city_id),setHeader(city),$.mobile.pageContainer.pagecontainer("change","#offerHelp"))}}):homeUsed=!1),"searchHelp"==c){null==city?$.ajax({url:baseUrl,context:this}).success(function(a){a.success?(city=a.city_id,cities=a.cities,setHeader(city)):$.mobile.pageContainer.pagecontainer("change","#home")}):setHeader(city);var d=new Date,e=(new Date).getTimezoneOffset(),f=d.getUTCDay(),g=new Array;g[0]="Sunday",g[1]="Monday",g[2]="Tuesday",g[3]="Wednesday",g[4]="Thursday",g[5]="Friday",g[6]="Saturday";for(var h=0;h<=g.length;h++)0==h?$("#choice-day-"+h).html("Today ("+g[(f+h)%g.length]+")"):1==h?$("#choice-day-"+h).html("Tomorrow ("+g[(f+h)%g.length]+")"):$("#choice-day-"+h).html(g[(f+h)%g.length]);$("#select-choice-day").selectmenu("refresh",!0);var i=d.getUTCHours()-e/60;$("#choice-hour-"+i).attr("selected",!0),$("#select-choice-hours").selectmenu("refresh",!0)}"helpdata"==c&&($(".city").html("Your overview"),$.ajax({url:baseUrl+"/myhelp",context:this}).success(function(a){a.success&&$("#helpDataReq").html(a.html).trigger("create")})),"offerHelp"==c&&(null==city&&(window.location="/"),setHeader(city),$.ajax({url:baseUrl+"/"+city+"/insertions",context:this}).done(function(a){a.success&&setContent(a.html)}))}).on("pagecontainershow",function(){var c=$.mobile.pageContainer.pagecontainer("getActivePage")[0].id;"home"==c&&$(".chooseCity").on("change",function(a){a.preventDefault(),a.stopPropagation(),a.stopImmediatePropagation(),city=$(this).val(),setHeader(city),$.ajax({type:"post",url:baseUrl,context:this,data:{city_id:city}}).success(function(a){a.success&&(city=a.city,cities=a.cities,$.mobile.pageContainer.pagecontainer("change","#offerHelp"))})}),"searchHelp"==c&&$("#createHelpRequest").on(tc,function(a){return a.preventDefault(),a.stopPropagation(),a.stopImmediatePropagation(),0==IsValidAmount($("#helperRequested").val())?(alert("How many helpers are nedded?"),!1):""==$.trim($("#address").val())?(alert("Please enter an address"),!1):($.ajax({type:"post",url:baseUrl+"/"+city+"/insertions",context:this,data:$(this).parent().serialize()}).success(function(a){a.success?$.mobile.pageContainer.pagecontainer("change","#offerHelp"):alert("Something failed.")}),void 0)}),"helpdata"==c&&$(this).on(tc,".help",function(a){a.preventDefault(),a.stopPropagation(),a.stopImmediatePropagation(),$(this).html('<span class="ui-btn-inner"><span class="ui-btn-text">Please wait...</span></span>').removeAttr("data-role");var b=$(this).data("amount");$.ajax({type:"post",url:baseUrl+"/"+city+"/insertions/"+$(this).data("iid")+"/help",context:this,data:{amount:b},dataType:"json"}).success(function(a){a.success&&$("#helpDataReq").html(a.html).trigger("create")})}).on("change",".amountHelper",function(a){a.preventDefault(),a.stopPropagation(),a.stopImmediatePropagation();var b=parseInt($("select.amountHelper option:selected").val()),c=$(this).parent().parent().parent().find(".help");"increaseHelp"==c.data("help")?c.html('<span class="ui-btn-inner"><span class="ui-btn-text">'+(b>1?"are coming!":"come!")+"</span></span>").data("amount",b):c.html('<span class="ui-btn-inner"><span class="ui-btn-text">'+(b>1?"Revoke "+b:"Revoke!")+"</span></span>").data("amount",-b)}).on(tc,".delete",function(a){a.preventDefault(),a.stopPropagation(),a.stopImmediatePropagation(),$.ajax({type:"delete",url:baseUrl+"/"+city+"/insertions/"+$(this).data("iid"),context:this,dataType:"json"}).success(function(a){a.success?$("#helpDataReq").html(a.html).trigger("create"):alert("Deleting the help-request failed.")})}),"offerHelp"==c&&$(this).on(tc,".delete",function(a){a.preventDefault(),a.stopPropagation(),a.stopImmediatePropagation(),$.ajax({type:"delete",url:baseUrl+"/"+city+"/insertions/"+$(this).data("iid"),context:this,dataType:"json"}).success(function(a){a.success?setContent(a.html):alert("Deleting the help-request failed.")})}).on(tc,".help",function(a){a.preventDefault(),a.stopPropagation(),a.stopImmediatePropagation(),$(this).html('<span class="ui-btn-inner"><span class="ui-btn-text">Please wait...</span></span>').removeAttr("data-role");var b=$(this).data("amount");$.ajax({type:"post",url:baseUrl+"/"+city+"/insertions/"+$(this).data("iid")+"/help",context:this,data:{amount:b},dataType:"json"}).success(function(a){a.success&&setContent(a.html)})}).on("change",".amountHelper",function(a){a.preventDefault(),a.stopPropagation(),a.stopImmediatePropagation();var b=parseInt($("select.amountHelper option:selected").val()),c=$(this).parent().parent().parent().find(".help");"increaseHelp"==c.data("help")?c.html('<span class="ui-btn-inner"><span class="ui-btn-text">'+(b>1?"will come!":"will come!")+"</span></span>").data("amount",b):c.html('<span class="ui-btn-inner"><span class="ui-btn-text">'+(b>1?"Revoke "+b:"Revoke!")+"</span></span>").data("amount",-b)})}).bind("pagecreate",function(){$.ajaxSetup(),$.mobile.linkBindingEnabled=!0,$.mobile.ajaxEnabled=!0,$('a[data-icon="home"]').on(tc,function(){homeUsed=!0,$.mobile.pageContainer.pagecontainer("change","#home")})});